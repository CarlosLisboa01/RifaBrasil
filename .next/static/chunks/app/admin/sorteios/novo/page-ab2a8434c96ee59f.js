(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[216],{1655:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>g});var t=s(5155),a=s(2115),i=s(5695),n=s(6874),o=s.n(n),l=s(2177),m=s(221),c=s(5594),d=s(5522),u=s(6766);let x=c.z.object({title:c.z.string().min(3,"T\xedtulo deve ter no m\xednimo 3 caracteres"),description:c.z.string().min(10,"Descri\xe7\xe3o deve ter no m\xednimo 10 caracteres"),min_number:c.z.string().min(1,"Campo obrigat\xf3rio"),max_number:c.z.string().min(1,"Campo obrigat\xf3rio"),unit_price:c.z.string().min(1,"Valor unit\xe1rio \xe9 obrigat\xf3rio")}).refine(e=>{let r=parseInt(e.min_number);return parseInt(e.max_number),!isNaN(r)&&r>=1},{message:"N\xfamero m\xednimo deve ser um n\xfamero maior ou igual a 1",path:["min_number"]}).refine(e=>{parseInt(e.min_number);let r=parseInt(e.max_number);return!isNaN(r)&&r>=1},{message:"N\xfamero m\xe1ximo deve ser um n\xfamero maior ou igual a 1",path:["max_number"]}).refine(e=>{let r=parseInt(e.min_number),s=parseInt(e.max_number);return!isNaN(r)&&!isNaN(s)&&s>r},{message:"O n\xfamero m\xe1ximo deve ser maior que o n\xfamero m\xednimo",path:["max_number"]}).refine(e=>{let r=parseFloat(e.unit_price.replace(",","."));return!isNaN(r)&&r>0},{message:"O valor unit\xe1rio deve ser um n\xfamero maior que zero",path:["unit_price"]});function g(){let e=(0,i.useRouter)(),[r,s]=(0,a.useState)(!0),[n,c]=(0,a.useState)(!1),[g,p]=(0,a.useState)(null),[f,h]=(0,a.useState)(null),[b,v]=(0,a.useState)(!1),[N,j]=(0,a.useState)(null),[y,_]=(0,a.useState)(null),w=(0,a.useRef)(null),{register:k,handleSubmit:I,formState:{errors:C}}=(0,l.mN)({resolver:(0,m.u)(x),defaultValues:{title:"",description:"",min_number:"1",max_number:"100",unit_price:"10,00"}});(0,a.useEffect)(()=>{(async()=>{try{var r;let{data:s}=await d.N.auth.getSession(),t=(null==(r=s.session)?void 0:r.user)||null;if(!t)return void e.push("/login");let{data:a,error:i}=await d.N.from("admin_users").select("*").eq("user_id",t.id);if(i){console.error("Erro ao verificar permiss\xf5es:",i),e.push("/login");return}if(!a||0===a.length)return void e.push("/login");v(!0)}catch(e){console.error("Erro:",e),p(e.message||"Ocorreu um erro ao verificar suas permiss\xf5es")}finally{s(!1)}})()},[e]);let R=async r=>{try{c(!0),p(null),h(null);let s=parseInt(r.min_number),t=parseInt(r.max_number),a=parseFloat(r.unit_price.replace(",",".")),i=null;if(N)try{let e=Date.now()+"_"+N.name.replace(/\s+/g,"_"),{data:r,error:s}=await d.N.storage.from("raffle-images").upload(e,N,{cacheControl:"3600",upsert:!1});if(s)throw Error("Erro ao fazer upload da imagem: ".concat(s.message));let{data:{publicUrl:t}}=d.N.storage.from("raffle-images").getPublicUrl(e);i=t}catch(e){console.error("Erro de upload:",e),p("Erro no upload da imagem: ".concat(e.message,". Prosseguindo sem imagem."))}let{data:n,error:o}=await d.N.from("raffles").insert({title:r.title,description:r.description,min_number:s,max_number:t,unit_price:a,image_url:i,status:"open"}).select().single();if(o){if(o.message.includes("unit_price")){let{data:a,error:n}=await d.N.from("raffles").insert({title:r.title,description:r.description,min_number:s,max_number:t,status:"open",image_url:i}).select().single();if(n)throw n;h("Rifa criada com sucesso (sem valor unit\xe1rio - adicione a coluna unit_price na tabela)"),setTimeout(()=>{e.push("/admin/sorteios/"+a.id)},2e3);return}throw o}h("Rifa criada com sucesso!"),setTimeout(()=>{e.push("/admin/sorteios/"+n.id)},2e3)}catch(e){console.error("Erro ao criar rifa:",e),p(e.message||"Erro ao criar a rifa")}finally{c(!1)}};return r?(0,t.jsx)("div",{className:"flex justify-center items-center min-h-[80vh]",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})}):b?(0,t.jsxs)("div",{className:"max-w-2xl mx-auto mt-8 mb-12 px-4",children:[(0,t.jsxs)("div",{className:"flex items-center mb-6",children:[(0,t.jsx)(o(),{href:"/admin",className:"text-green-600 hover:text-green-800 mr-2",children:"â† Voltar ao Painel"}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-green-600 ml-2",children:"Criar Nova Rifa"})]}),g&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-red-100 text-red-700 rounded-md",children:g}),f&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-green-100 text-green-700 rounded-md",children:f}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden border-t-4 border-green-600",children:(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("form",{onSubmit:I(R),className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"T\xedtulo da Rifa *"}),(0,t.jsx)("input",{id:"title",type:"text",...k("title"),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",placeholder:"Ex: Rifa de Natal 2023"}),C.title&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:C.title.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri\xe7\xe3o da Rifa *"}),(0,t.jsx)("textarea",{id:"description",...k("description"),rows:4,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",placeholder:"Descreva os detalhes da rifa, pr\xeamios, regras, etc."}),C.description&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:C.description.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Imagem da Rifa"}),(0,t.jsxs)("div",{className:"mt-1 flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"flex justify-center items-center w-32 h-32 border-2 border-dashed rounded-md \n                    ".concat(y?"border-green-300":"border-gray-300 hover:border-green-400"," \n                    ").concat(y?"":"cursor-pointer"),onClick:()=>{var e;return!y&&(null==(e=w.current)?void 0:e.click())},children:y?(0,t.jsx)("div",{className:"relative w-full h-full",children:(0,t.jsx)(u.default,{src:y,alt:"Preview",fill:!0,className:"object-cover rounded-md"})}):(0,t.jsxs)("div",{className:"space-y-1 text-center",children:[(0,t.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true",children:(0,t.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Clique para adicionar"})]})}),(0,t.jsx)("input",{type:"file",className:"hidden",accept:"image/jpeg, image/png, image/gif",ref:w,onChange:e=>{var r;let s=(null==(r=e.target.files)?void 0:r[0])||null;return s?s.type.match(/^image\/(jpeg|jpg|png|gif)$/)?s.size>5242880?void p("A imagem n\xe3o pode ter mais de 5MB."):void(j(s),_(URL.createObjectURL(s))):void p("Por favor, selecione uma imagem v\xe1lida (JPEG, PNG ou GIF)."):void 0}}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=w.current)?void 0:e.click()},className:"inline-flex items-center px-3 py-2 text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:y?"Trocar Imagem":"Selecionar Imagem"}),y&&(0,t.jsx)("button",{type:"button",onClick:()=>{j(null),y&&URL.revokeObjectURL(y),_(null),w.current&&(w.current.value="")},className:"inline-flex items-center px-3 py-2 text-sm font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Remover"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"JPG, PNG ou GIF. M\xe1ximo 5MB."})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"min_number",className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xfamero M\xednimo *"}),(0,t.jsx)("input",{id:"min_number",type:"text",inputMode:"numeric",pattern:"[0-9]*",...k("min_number"),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"}),C.min_number&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:C.min_number.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"max_number",className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xfamero M\xe1ximo *"}),(0,t.jsx)("input",{id:"max_number",type:"text",inputMode:"numeric",pattern:"[0-9]*",...k("max_number"),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"}),C.max_number&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:C.max_number.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"unit_price",className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor Unit\xe1rio (R$) *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)("span",{className:"text-gray-500 sm:text-sm",children:"R$"})}),(0,t.jsx)("input",{id:"unit_price",type:"text",inputMode:"decimal",placeholder:"0,00",...k("unit_price"),className:"block w-full pl-11 pr-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"})]}),C.unit_price&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:C.unit_price.message})]})]}),(0,t.jsx)("div",{className:"border-t pt-4",children:(0,t.jsx)("button",{type:"submit",disabled:n,className:"w-full py-3 px-4 rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 ".concat(n?"opacity-70 cursor-not-allowed":""),children:n?"Criando...":"Criar Rifa"})})]})})})]}):(0,t.jsxs)("div",{className:"max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-md border-t-4 border-green-600",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-center mb-6 text-green-700",children:"Acesso Restrito"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6 text-center",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar esta \xe1rea."}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(o(),{href:"/",className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"Voltar para o in\xedcio"})})]})}},3100:(e,r,s)=>{Promise.resolve().then(s.bind(s,1655))},5522:(e,r,s)=>{"use strict";s.d(r,{N:()=>n});var t=s(851);let a="https://nkuadhiaeosakxxozxmc.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rdWFkaGlhZW9zYWt4eG96eG1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ4OTQwMzAsImV4cCI6MjA2MDQ3MDAzMH0.SsjaoXLXHV6nOLpCuindrlJ7d1LUbyAteQjSK4Lp9QU";a&&i||console.warn("Vari\xe1veis de ambiente do Supabase n\xe3o definidas corretamente");let n=(0,t.UU)(a,i)}},e=>{var r=r=>e(e.s=r);e.O(0,[851,874,564,766,441,684,358],()=>r(3100)),_N_E=e.O()}]);