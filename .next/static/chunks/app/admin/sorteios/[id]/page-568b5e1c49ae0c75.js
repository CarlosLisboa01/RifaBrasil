(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[371],{1727:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var r=t(5155),a=t(2115),n=t(5695),l=t(6874),i=t.n(l),d=t(5522);function c(e){let{params:s}=e,t=(0,n.useRouter)(),[l,c]=(0,a.useState)(!0),[o,m]=(0,a.useState)(null),[x,h]=(0,a.useState)(null),[u,p]=(0,a.useState)([]),[g,b]=(0,a.useState)([]),[f,N]=(0,a.useState)(""),[j,w]=(0,a.useState)(!1),[v,y]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{var e;c(!0);let{data:r}=await d.N.auth.getSession(),a=(null==(e=r.session)?void 0:e.user)||null;if(!a)return void t.push("/login");let{data:n,error:l}=await d.N.from("admin_users").select("*").eq("user_id",a.id).single();if(l){if("PGRST116"===l.code)return void t.push("/login");throw l}w(!0);let{data:i,error:o}=await d.N.from("raffles").select("*").eq("id",s.id).single();if(o)throw o;if(h(i),i.winner_id){let{data:e,error:t}=await d.N.from("participants").select("*").eq("id",i.winner_id).single();if(!t&&e){let{data:t,error:r}=await d.N.from("raffles_draws").select("drawn_number").eq("raffle_id",s.id).order("created_at",{ascending:!1}).limit(1).single(),a=(null==t?void 0:t.drawn_number)||null;h({...i,winner:e,winning_number:a})}}let{data:m,error:x}=await d.N.from("participants").select("*").eq("raffle_id",s.id);if(x)throw x;p(m||[]),b(m||[])}catch(e){console.error("Erro:",e),m(e.message||"Ocorreu um erro ao carregar o sorteio")}finally{c(!1)}})()},[s.id,t]),(0,a.useEffect)(()=>{if(!f.trim())return void b(u);let e=f.toLowerCase().trim();b(u.filter(s=>{let t=s.name.toLowerCase().includes(e),r=!isNaN(Number(e))&&s.chosen_numbers.some(s=>s.toString().includes(e)),a=s.phone.toLowerCase().includes(e);return t||r||a}))},[f,u]);let _=e=>{if(v){if(e.length>5){let s=e.substring(0,3),t=e.substring(e.length-2),r="*".repeat(e.length-5);return"".concat(s).concat(r).concat(t)}let s=Math.ceil(e.length/2);return e.substring(0,s)+"*".repeat(e.length-s)}return e};return l?(0,r.jsx)("div",{className:"flex justify-center items-center min-h-[80vh]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):j?x?(0,r.jsxs)("div",{className:"max-w-4xl mx-auto mt-8 mb-12 px-4",children:[(0,r.jsxs)("div",{className:"flex items-center mb-6",children:[(0,r.jsx)(i(),{href:"/admin",className:"text-blue-600 hover:text-blue-800 mr-2",children:"← Voltar ao Painel"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-blue-600 ml-2",children:"Detalhes do Sorteio"})]}),o&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-red-100 text-red-700 rounded-md",children:o}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden mb-8",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:x.title}),(0,r.jsx)("span",{className:"px-3 py-1 text-sm rounded-full ".concat((e=>{switch(e){case"open":return"bg-green-100 text-green-800";case"closed":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}})(x.status)),children:(e=>{switch(e){case"open":return"Aberto";case"closed":return"Fechado";case"completed":return"Finalizado";default:return e}})(x.status)})]}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:x.description}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"N\xfameros"}),(0,r.jsxs)("div",{className:"font-semibold",children:[x.min_number," a ",x.max_number]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Participantes"}),(0,r.jsx)("div",{className:"font-semibold",children:u.length})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Data de Cria\xe7\xe3o"}),(0,r.jsx)("div",{className:"font-semibold",children:new Date(x.created_at).toLocaleDateString("pt-BR")})]})]}),(0,r.jsxs)("div",{className:"border-t pt-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"A\xe7\xf5es dispon\xedveis"}),(0,r.jsxs)("div",{className:"space-x-3",children:["open"===x.status&&(0,r.jsx)(i(),{href:"/admin/sorteios/".concat(x.id,"/fechar"),className:"px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition-colors inline-block",children:"Fechar Sorteio"}),"closed"===x.status&&(0,r.jsx)(i(),{href:"/admin/sorteios/".concat(x.id,"/sorteio"),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors inline-block",children:"Realizar Sorteio"}),(0,r.jsx)(i(),{href:"/admin/sorteios/".concat(x.id,"/exportar"),className:"px-4 py-2 border border-blue-600 text-blue-600 rounded-md hover:bg-blue-50 transition-colors inline-block ml-2",children:"Exportar Dados"})]})]}),"completed"===x.status&&x.winner&&(0,r.jsxs)("div",{className:"mt-6 border-t pt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Resultado do Sorteio"}),(0,r.jsx)("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"inline-flex items-center justify-center h-16 w-16 rounded-full bg-green-100 text-green-600 mb-4",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,r.jsx)("h4",{className:"text-xl font-bold text-green-800 mb-2",children:"Vencedor"}),(0,r.jsx)("p",{className:"text-lg font-bold",children:x.winner.name}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:_(x.winner.phone)}),(0,r.jsxs)("div",{children:[x.winning_number&&(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"N\xfamero sorteado:"}),(0,r.jsx)("span",{className:"inline-block px-4 py-2 bg-red-500 text-white font-bold rounded-full text-lg",children:x.winning_number})]}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"N\xfameros escolhidos:"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:x.winner.chosen_numbers.map(e=>(0,r.jsx)("span",{className:"inline-block px-3 py-1 rounded-full text-sm ".concat(x.winning_number===e?"bg-red-500 text-white font-bold":"bg-green-100 text-green-800"),children:e},e))})]}),x.drawn_at&&(0,r.jsxs)("p",{className:"mt-4 text-sm text-gray-500",children:["Sorteio realizado em: ",new Date(x.drawn_at).toLocaleString("pt-BR")]})]})})]})]})}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4 border-b bg-gray-50 flex flex-col sm:flex-row justify-between items-center",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold mb-2 sm:mb-0",children:["Lista de Participantes (",u.length,")"]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 w-full sm:w-auto",children:[(0,r.jsxs)("div",{className:"relative w-full sm:w-72",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,r.jsx)("input",{type:"text",placeholder:"Buscar por nome ou n\xfamero...",value:f,onChange:e=>N(e.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{className:"flex items-center whitespace-nowrap",children:[(0,r.jsx)("input",{type:"checkbox",id:"hide-phone",checked:v,onChange:()=>y(!v),className:"mr-2 h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),(0,r.jsx)("label",{htmlFor:"hide-phone",className:"text-sm text-gray-700",children:"Ocultar telefones"})]})]})]}),0===u.length?(0,r.jsx)("div",{className:"text-center py-10",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Nenhum participante registrado neste sorteio."})}):0===g.length?(0,r.jsx)("div",{className:"text-center py-10",children:(0,r.jsxs)("p",{className:"text-gray-500",children:['Nenhum participante encontrado para "',f,'".']})}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Telefone"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"N\xfameros Escolhidos"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(e=>(0,r.jsxs)("tr",{className:x.winner_id===e.id?"bg-green-50":"",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.name,x.winner_id===e.id&&(0,r.jsx)("span",{className:"ml-2 inline-block px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded-full",children:"Vencedor"})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-500",children:_(e.phone)})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:e.chosen_numbers.map(s=>(0,r.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(x.winner_id===e.id&&x.winning_number===s?"bg-red-500 text-white font-bold":"bg-blue-100 text-blue-800"),children:s},s))})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("pt-BR")})]},e.id))})]})}),g.length>0&&(0,r.jsx)("div",{className:"px-6 py-3 bg-gray-50 text-sm text-gray-500",children:f&&g.length!==u.length?"Mostrando ".concat(g.length," de ").concat(u.length," participantes."):"Total: ".concat(u.length," participantes.")})]})]}):(0,r.jsxs)("div",{className:"max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-md",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:"Sorteio n\xe3o encontrado"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6 text-center",children:"O sorteio solicitado n\xe3o foi encontrado."}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(i(),{href:"/admin",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Voltar para o painel"})})]}):(0,r.jsxs)("div",{className:"max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-md",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:"Acesso Restrito"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6 text-center",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar esta \xe1rea."}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(i(),{href:"/",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Voltar para o in\xedcio"})})]})}},5522:(e,s,t)=>{"use strict";t.d(s,{N:()=>l});var r=t(851);let a="https://nkuadhiaeosakxxozxmc.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rdWFkaGlhZW9zYWt4eG96eG1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ4OTQwMzAsImV4cCI6MjA2MDQ3MDAzMH0.SsjaoXLXHV6nOLpCuindrlJ7d1LUbyAteQjSK4Lp9QU";a&&n||console.warn("Vari\xe1veis de ambiente do Supabase n\xe3o definidas corretamente");let l=(0,r.UU)(a,n)},5695:(e,s,t)=>{"use strict";var r=t(8999);t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}})},7325:(e,s,t)=>{Promise.resolve().then(t.bind(t,1727))}},e=>{var s=s=>e(e.s=s);e.O(0,[851,874,441,684,358],()=>s(7325)),_N_E=e.O()}]);