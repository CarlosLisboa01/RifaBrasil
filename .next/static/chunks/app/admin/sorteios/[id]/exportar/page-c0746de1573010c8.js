(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[693],{4550:(e,t,r)=>{Promise.resolve().then(r.bind(r,6368))},5522:(e,t,r)=>{"use strict";r.d(t,{N:()=>i});var s=r(851);let a="https://nkuadhiaeosakxxozxmc.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rdWFkaGlhZW9zYWt4eG96eG1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ4OTQwMzAsImV4cCI6MjA2MDQ3MDAzMH0.SsjaoXLXHV6nOLpCuindrlJ7d1LUbyAteQjSK4Lp9QU";a&&n||console.warn("Vari\xe1veis de ambiente do Supabase n\xe3o definidas corretamente");let i=(0,s.UU)(a,n)},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},6368:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var s=r(5155),a=r(2115),n=r(5695),i=r(6874),l=r.n(i),o=r(5522);function d(e){let{params:t}=e,r=(0,n.useRouter)(),[i,d]=(0,a.useState)(!0),[c,x]=(0,a.useState)(null),[p,m]=(0,a.useState)([]),[h,u]=(0,a.useState)(!1),[g,b]=(0,a.useState)(null),[f,j]=(0,a.useState)(!1),[y,N]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{var e;d(!0);let{data:s}=await o.N.auth.getSession(),a=(null==(e=s.session)?void 0:e.user)||null;if(!a)return void r.push("/login");let{data:n,error:i}=await o.N.from("admin_users").select("*").eq("user_id",a.id).single();if(i){if("PGRST116"===i.code)return void r.push("/login");throw i}u(!0);let{data:l,error:c}=await o.N.from("raffles").select("*").eq("id",t.id).single();if(c)throw c;x(l);let{data:p,error:h}=await o.N.from("participants").select("*").eq("raffle_id",t.id);if(h)throw h;m(p||[])}catch(e){console.error("Erro:",e),b(e.message||"Ocorreu um erro ao carregar os dados")}finally{d(!1)}})()},[t.id,r]);let w=e=>{if(y){if(e.length>5){let t=e.substring(0,3),r=e.substring(e.length-2),s="*".repeat(e.length-5);return"".concat(t).concat(s).concat(r)}let t=Math.ceil(e.length/2);return e.substring(0,t)+"*".repeat(e.length-t)}return e};return i?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-green-600 border-t-transparent rounded-full animate-spin"}),(0,s.jsx)("p",{className:"mt-4 text-lg",children:"Carregando..."})]}):h?g?(0,s.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Erro"}),(0,s.jsx)("p",{className:"text-lg mb-6",children:g}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:()=>b(null),className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition",children:"Tentar Novamente"}),(0,s.jsx)(l(),{href:"/admin/sorteios/".concat(t.id),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:"Voltar para o Sorteio"})]})]}):(0,s.jsxs)("div",{className:"container mx-auto p-4",children:[(0,s.jsxs)("header",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-green-600",children:"Exportar Dados do Sorteio"}),(0,s.jsx)(l(),{href:"/admin/sorteios/".concat(t.id),className:"px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 transition flex items-center",children:(0,s.jsx)("span",{children:"Voltar"})})]}),c&&(0,s.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-green-800",children:c.title}),(0,s.jsx)("p",{className:"text-gray-700 mt-1",children:c.description}),(0,s.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(0,s.jsxs)("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-sm rounded-full",children:["N\xfameros: ",c.min_number," a ",c.max_number]}),(0,s.jsxs)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:["Status: ",c.status]}),(0,s.jsxs)("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-sm rounded-full",children:["Participantes: ",p.length]})]})]})]}),(0,s.jsxs)("main",{children:[(0,s.jsxs)("section",{className:"mb-8",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Escolha o Formato de Exporta\xe7\xe3o"}),(0,s.jsxs)("div",{className:"mb-4 flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"hide-phone-export",checked:y,onChange:()=>N(!y),className:"mr-2 h-5 w-5 text-green-600 rounded border-gray-300 focus:ring-green-500"}),(0,s.jsx)("label",{htmlFor:"hide-phone-export",className:"text-gray-700",children:"Ocultar n\xfameros de telefone na exporta\xe7\xe3o"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,s.jsx)("button",{onClick:()=>{try{if(j(!0),!p||0===p.length)throw Error("N\xe3o h\xe1 participantes para exportar");let e=["ID,Nome,Telefone,N\xfameros Escolhidos,Data de Registro",...p.map(e=>[e.id,'"'.concat(e.name.replace(/"/g,'""'),'"'),'"'.concat(w(e.phone).replace(/"/g,'""'),'"'),'"'.concat(e.chosen_numbers.join(", "),'"'),new Date(e.created_at).toLocaleString("pt-BR")].join(","))].join("\n"),r=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=window.URL.createObjectURL(r),a=document.createElement("a");a.setAttribute("href",s),a.setAttribute("download","participantes_sorteio_".concat((null==c?void 0:c.title)||t.id,"_").concat(new Date().toISOString().split("T")[0],".csv")),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),j(!1)}catch(e){console.error("Erro ao exportar:",e),b(e.message||"Erro ao gerar arquivo CSV"),j(!1)}},disabled:f||0===p.length,className:"px-6 py-3 rounded-md transition-colors flex items-center gap-2 ".concat(f||0===p.length?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"),children:f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,s.jsx)("span",{children:"Exportando..."})]}):(0,s.jsx)("span",{children:"Exportar como CSV"})}),(0,s.jsx)("button",{onClick:()=>{try{if(j(!0),!p||0===p.length){b("N\xe3o h\xe1 participantes para exportar"),j(!1);return}let e={raffle:{id:null==c?void 0:c.id,title:null==c?void 0:c.title,description:null==c?void 0:c.description,status:null==c?void 0:c.status,min_number:null==c?void 0:c.min_number,max_number:null==c?void 0:c.max_number,created_at:null==c?void 0:c.created_at,drawn_at:null==c?void 0:c.drawn_at,winner_id:null==c?void 0:c.winner_id},participants:p.map(e=>({id:e.id,name:e.name,phone:w(e.phone),chosen_numbers:e.chosen_numbers,created_at:e.created_at})),export_date:new Date().toISOString(),total_participants:p.length,phone_numbers_masked:y},t=JSON.stringify(e,null,2),r=new Blob([t],{type:"application/json"}),s=window.URL.createObjectURL(r),a=document.createElement("a");a.setAttribute("href",s),a.setAttribute("download","RifaBrasil_".concat(null==c?void 0:c.title.replace(/\s+/g,"_"),"_").concat(new Date().toISOString().split("T")[0],".json")),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),j(!1)}catch(e){console.error("Erro ao exportar:",e),b(e.message||"Erro ao gerar arquivo JSON"),j(!1)}},disabled:f||0===p.length,className:"px-6 py-3 rounded-md transition-colors flex items-center gap-2 ".concat(f||0===p.length?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,s.jsx)("span",{children:"Exportando..."})]}):(0,s.jsx)("span",{children:"Exportar como JSON"})})]}),0===p.length&&(0,s.jsx)("p",{className:"mt-4 text-red-600",children:"N\xe3o h\xe1 participantes neste sorteio para exportar."})]}),p.length>0&&(0,s.jsxs)("section",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Pr\xe9via dos Dados"}),(0,s.jsxs)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:[(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Telefone"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"N\xfameros"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data de Registro"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:p.slice(0,10).map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.id}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:w(e.phone)}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[e.chosen_numbers.slice(0,10).map(e=>(0,s.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:e},e)),e.chosen_numbers.length>10&&(0,s.jsxs)("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded-full",children:["+",e.chosen_numbers.length-10," mais"]})]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleString("pt-BR")})]},e.id))})]}),p.length>10&&(0,s.jsxs)("div",{className:"px-6 py-3 bg-gray-50 text-sm text-gray-500",children:["Mostrando 10 de ",p.length," participantes. Exporte para ver todos."]})]})]})]})]}):(0,s.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Acesso Restrito"}),(0,s.jsx)("p",{className:"text-lg mb-6",children:"Apenas administradores podem acessar esta p\xe1gina."}),(0,s.jsx)(l(),{href:"/",className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition",children:"Voltar para Home"})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[851,874,441,684,358],()=>t(4550)),_N_E=e.O()}]);