(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{588:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(5155),a=s(2115),l=s(5695),i=s(6874),n=s.n(i),d=s(5522);function o(e){var t,s;let{params:i}=e,o=(0,l.useRouter)(),[c,m]=(0,a.useState)(!0),[x,h]=(0,a.useState)(!1),[u,p]=(0,a.useState)(null),[g,b]=(0,a.useState)(null),[f,N]=(0,a.useState)(null),[j,w]=(0,a.useState)([]),[v,y]=(0,a.useState)(null),[S,_]=(0,a.useState)(!1),[k,z]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{var e;m(!0);let{data:t}=await d.N.auth.getSession(),s=(null==(e=t.session)?void 0:e.user)||null;if(!s)return void o.push("/login");let{data:r,error:a}=await d.N.from("admin_users").select("*").eq("user_id",s.id).single();if(a){if("PGRST116"===a.code)return void o.push("/login");throw a}_(!0);let{data:l,error:n}=await d.N.from("raffles").select("*").eq("id",i.id).single();if(n)throw n;if("closed"!==l.status){p('Este sorteio n\xe3o est\xe1 pronto para ser realizado. O status deve ser "Fechado".'),N(l);return}N(l);let{data:c,error:x}=await d.N.from("participants").select("*").eq("raffle_id",i.id);if(x)throw x;if(!c||0===c.length)return void p("N\xe3o h\xe1 participantes neste sorteio.");w(c)}catch(e){console.error("Erro:",e),p(e.message||"Ocorreu um erro ao carregar o sorteio")}finally{m(!1)}})()},[i.id,o]);let I=async()=>{try{if(h(!0),p(null),b(null),!f||!j||0===j.length)throw Error("N\xe3o foi poss\xedvel realizar o sorteio. Verifique se h\xe1 participantes.");let e=Math.floor(Math.random()*j.length),t=j[e],s=t.chosen_numbers,r=Math.floor(Math.random()*s.length),a=s[r];y(t);let{error:l}=await d.N.from("raffles").update({status:"completed",winner_id:t.id,drawn_at:new Date().toISOString()}).eq("id",f.id);if(l)throw l;let{error:i}=await d.N.from("raffles_draws").insert({raffle_id:f.id,drawn_number:a,created_at:new Date().toISOString()});i&&console.error("Erro ao salvar n\xfamero sorteado:",i),b("Sorteio realizado com sucesso! N\xfamero sorteado: ".concat(a)),N({...f,status:"completed",winner_id:t.id,drawn_at:new Date().toISOString()})}catch(e){console.error("Erro ao realizar sorteio:",e),p(e.message||"Erro ao realizar o sorteio")}finally{h(!1)}},O=e=>{if(k){if(e.length>5){let t=e.substring(0,3),s=e.substring(e.length-2),r="*".repeat(e.length-5);return"".concat(t).concat(r).concat(s)}let t=Math.ceil(e.length/2);return e.substring(0,t)+"*".repeat(e.length-t)}return e};return c?(0,r.jsx)("div",{className:"flex justify-center items-center min-h-[80vh]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):S?f?(0,r.jsxs)("div",{className:"max-w-4xl mx-auto mt-8 mb-12 px-4",children:[(0,r.jsxs)("div",{className:"flex items-center mb-6",children:[(0,r.jsx)(n(),{href:"/admin",className:"text-blue-600 hover:text-blue-800 mr-2",children:"← Voltar ao Painel"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-blue-600 ml-2",children:"Realizar Sorteio"})]}),u&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-red-100 text-red-700 rounded-md",children:u}),g&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-green-100 text-green-700 rounded-md",children:g}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden mb-8",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:f.title}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:f.description}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Status"}),(0,r.jsx)("div",{className:"font-semibold",children:"open"===f.status?"Aberto":"closed"===f.status?"Fechado":"Finalizado"})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"N\xfameros"}),(0,r.jsxs)("div",{className:"font-semibold",children:[f.min_number," a ",f.max_number]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Participantes"}),(0,r.jsx)("div",{className:"font-semibold",children:j.length})]})]}),"closed"===f.status&&!v&&(0,r.jsxs)("div",{className:"text-center mt-6",children:[(0,r.jsx)("button",{onClick:I,disabled:x||0===j.length,className:"px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Realizando sorteio...":"Realizar Sorteio Agora"}),0===j.length&&(0,r.jsx)("p",{className:"mt-2 text-red-500 text-sm",children:"N\xe3o h\xe1 participantes para sortear"})]}),(v||"completed"===f.status)&&(0,r.jsxs)("div",{className:"mt-8 border-t pt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Resultado do Sorteio"}),(0,r.jsxs)("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:[(0,r.jsx)("div",{className:"flex items-center justify-center mb-4",children:(0,r.jsx)("div",{className:"h-16 w-16 rounded-full bg-green-100 flex items-center justify-center",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})}),(0,r.jsx)("h4",{className:"text-xl font-bold text-center text-green-800 mb-2",children:"Vencedor"}),v?(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-lg font-bold",children:v.name}),(0,r.jsx)("p",{className:"text-gray-600",children:O(v.phone)}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"N\xfamero sorteado:"}),(0,r.jsx)("div",{className:"flex justify-center mb-4",children:v.chosen_numbers.includes(Number(null==g||null==(t=g.match(/\d+$/))?void 0:t[0]))&&(0,r.jsx)("span",{className:"inline-block px-4 py-2 bg-red-500 text-white font-bold rounded-full text-lg",children:null==g||null==(s=g.match(/\d+$/))?void 0:s[0]})}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"N\xfameros escolhidos:"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:v.chosen_numbers.map(e=>{var t;return(0,r.jsx)("span",{className:"inline-block px-3 py-1 rounded-full text-sm ".concat(String(e)===(null==g||null==(t=g.match(/\d+$/))?void 0:t[0])?"bg-red-500 text-white font-bold":"bg-green-100 text-green-800"),children:e},e)})})]}),(0,r.jsxs)("p",{className:"mt-4 text-sm text-gray-500",children:["Sorteio realizado em: ",new Date(f.drawn_at||new Date).toLocaleString("pt-BR")]})]}):(0,r.jsx)("p",{className:"text-center text-gray-600",children:"Informa\xe7\xf5es do vencedor n\xe3o dispon\xedveis."})]})]})]})}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4 border-b bg-gray-50 flex justify-between items-center",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold",children:["Lista de Participantes (",j.length,")"]}),(0,r.jsxs)("div",{className:"flex items-center whitespace-nowrap",children:[(0,r.jsx)("input",{type:"checkbox",id:"hide-phone",checked:k,onChange:()=>z(!k),className:"mr-2 h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),(0,r.jsx)("label",{htmlFor:"hide-phone",className:"text-sm text-gray-700",children:"Ocultar telefones"})]})]}),0===j.length?(0,r.jsx)("div",{className:"text-center py-10",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Nenhum participante registrado neste sorteio."})}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Telefone"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"N\xfameros Escolhidos"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(e=>(0,r.jsxs)("tr",{className:v&&v.id===e.id?"bg-green-50":"",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.name,v&&v.id===e.id&&(0,r.jsx)("span",{className:"ml-2 inline-block px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded-full",children:"Vencedor"})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-500",children:O(e.phone)})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:e.chosen_numbers.map(t=>{var s;return(0,r.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(v&&v.id===e.id&&String(t)===(null==g||null==(s=g.match(/\d+$/))?void 0:s[0])?"bg-red-500 text-white font-bold":"bg-blue-100 text-blue-800"),children:t},t)})})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("pt-BR")})]},e.id))})]})})]}),(0,r.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,r.jsx)(n(),{href:"/admin",className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Voltar para o Painel"}),(0,r.jsx)(n(),{href:"/admin/resultados",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",children:"Ver Todos os Resultados"})]})]}):(0,r.jsxs)("div",{className:"max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-md",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:"Sorteio n\xe3o encontrado"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6 text-center",children:"O sorteio solicitado n\xe3o foi encontrado."}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(n(),{href:"/admin",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Voltar para o painel"})})]}):(0,r.jsxs)("div",{className:"max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-md",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:"Acesso Restrito"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6 text-center",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar esta \xe1rea."}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(n(),{href:"/",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Voltar para o in\xedcio"})})]})}},5522:(e,t,s)=>{"use strict";s.d(t,{N:()=>i});var r=s(851);let a="https://nkuadhiaeosakxxozxmc.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rdWFkaGlhZW9zYWt4eG96eG1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ4OTQwMzAsImV4cCI6MjA2MDQ3MDAzMH0.SsjaoXLXHV6nOLpCuindrlJ7d1LUbyAteQjSK4Lp9QU";a&&l||console.warn("Vari\xe1veis de ambiente do Supabase n\xe3o definidas corretamente");let i=(0,r.UU)(a,l)},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},9364:(e,t,s)=>{Promise.resolve().then(s.bind(s,588))}},e=>{var t=t=>e(e.s=t);e.O(0,[851,874,441,684,358],()=>t(9364)),_N_E=e.O()}]);