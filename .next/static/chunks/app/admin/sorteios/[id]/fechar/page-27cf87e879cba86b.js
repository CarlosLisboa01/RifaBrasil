(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[605],{5092:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n});var a=t(5155),r=t(2115),l=t(5695),i=t(6874),o=t.n(i),d=t(5522);function n(e){let{params:s}=e,t=(0,l.useRouter)(),[i,n]=(0,r.useState)(!0),[c,m]=(0,r.useState)(!1),[x,h]=(0,r.useState)(null),[u,p]=(0,r.useState)(null),[b,g]=(0,r.useState)(null),[N,j]=(0,r.useState)([]),[f,y]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{var e;n(!0);let{data:a}=await d.N.auth.getSession(),r=(null==(e=a.session)?void 0:e.user)||null;if(!r)return void t.push("/login");let{data:l,error:i}=await d.N.from("admin_users").select("*").eq("user_id",r.id).single();if(i){if("PGRST116"===i.code)return void t.push("/login");throw i}y(!0);let{data:o,error:c}=await d.N.from("raffles").select("*").eq("id",s.id).single();if(c)throw c;if("open"!==o.status){h('Este sorteio n\xe3o pode ser fechado. O status deve ser "Aberto".'),g(o);return}g(o);let{data:m,error:x}=await d.N.from("participants").select("*").eq("raffle_id",s.id);if(x)throw x;j(m||[])}catch(e){console.error("Erro:",e),h(e.message||"Ocorreu um erro ao carregar o sorteio")}finally{n(!1)}})()},[s.id,t]);let w=async()=>{try{if(m(!0),h(null),p(null),!b)throw Error("Sorteio n\xe3o encontrado");let{error:e}=await d.N.from("raffles").update({status:"closed"}).eq("id",b.id);if(e)throw e;p("Sorteio fechado com sucesso! Agora ele est\xe1 pronto para o sorteio."),g({...b,status:"closed"}),setTimeout(()=>{t.push("/admin")},3e3)}catch(e){console.error("Erro ao fechar sorteio:",e),h(e.message||"Erro ao fechar o sorteio")}finally{m(!1)}};return i?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-[80vh]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):f?b?(0,a.jsxs)("div",{className:"max-w-4xl mx-auto mt-8 mb-12 px-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)(o(),{href:"/admin",className:"text-blue-600 hover:text-blue-800 mr-2",children:"← Voltar ao Painel"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-blue-600 ml-2",children:"Fechar Sorteio"})]}),x&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-red-100 text-red-700 rounded-md",children:x}),u&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-green-100 text-green-700 rounded-md",children:u}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden mb-8",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:b.title}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:b.description}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Status"}),(0,a.jsx)("div",{className:"font-semibold",children:"open"===b.status?(0,a.jsx)("span",{className:"text-green-600",children:"Aberto"}):"closed"===b.status?(0,a.jsx)("span",{className:"text-yellow-600",children:"Fechado"}):(0,a.jsx)("span",{className:"text-blue-600",children:"Finalizado"})})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"N\xfameros"}),(0,a.jsxs)("div",{className:"font-semibold",children:[b.min_number," a ",b.max_number]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Participantes"}),(0,a.jsx)("div",{className:"font-semibold",children:N.length})]})]}),"open"===b.status&&(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"Fechar este sorteio?"}),(0,a.jsx)("p",{className:"text-yellow-700 mb-4",children:"Ao fechar o sorteio, ele n\xe3o aceitar\xe1 mais participantes e estar\xe1 pronto para a realiza\xe7\xe3o do sorteio. Esta a\xe7\xe3o n\xe3o pode ser desfeita. Tem certeza que deseja continuar?"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("span",{className:"text-sm text-yellow-600 mr-4",children:["Total de participantes: ",(0,a.jsx)("strong",{children:N.length})]}),(0,a.jsx)("button",{onClick:w,disabled:c,className:"px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition-colors disabled:opacity-50",children:c?"Processando...":"Confirmar Fechamento"})]})]}),"closed"===b.status&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Sorteio Fechado"}),(0,a.jsx)("p",{className:"text-blue-700 mb-4",children:"Este sorteio j\xe1 est\xe1 fechado e pronto para ser realizado."}),(0,a.jsx)(o(),{href:"/admin/sorteios/".concat(b.id,"/sorteio"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors inline-block",children:"Ir para P\xe1gina de Sorteio"})]})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,a.jsx)("div",{className:"p-4 border-b bg-gray-50",children:(0,a.jsxs)("h2",{className:"text-xl font-semibold",children:["Lista de Participantes (",N.length,")"]})}),0===N.length?(0,a.jsx)("div",{className:"text-center py-10",children:(0,a.jsx)("p",{className:"text-gray-500",children:"Nenhum participante registrado neste sorteio."})}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Telefone"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"N\xfameros Escolhidos"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.phone})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:e.chosen_numbers.map(e=>(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800",children:e},e))})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("pt-BR")})]},e.id))})]})})]}),(0,a.jsx)("div",{className:"flex justify-between mt-8",children:(0,a.jsx)(o(),{href:"/admin",className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Voltar para o Painel"})})]}):(0,a.jsxs)("div",{className:"max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-md",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:"Sorteio n\xe3o encontrado"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6 text-center",children:"O sorteio solicitado n\xe3o foi encontrado."}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(o(),{href:"/admin",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Voltar para o painel"})})]}):(0,a.jsxs)("div",{className:"max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-md",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:"Acesso Restrito"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6 text-center",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar esta \xe1rea."}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(o(),{href:"/",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Voltar para o in\xedcio"})})]})}},5522:(e,s,t)=>{"use strict";t.d(s,{N:()=>i});var a=t(851);let r="https://nkuadhiaeosakxxozxmc.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rdWFkaGlhZW9zYWt4eG96eG1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ4OTQwMzAsImV4cCI6MjA2MDQ3MDAzMH0.SsjaoXLXHV6nOLpCuindrlJ7d1LUbyAteQjSK4Lp9QU";r&&l||console.warn("Vari\xe1veis de ambiente do Supabase n\xe3o definidas corretamente");let i=(0,a.UU)(r,l)},5695:(e,s,t)=>{"use strict";var a=t(8999);t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})},7326:(e,s,t)=>{Promise.resolve().then(t.bind(t,5092))}},e=>{var s=s=>e(e.s=s);e.O(0,[851,874,441,684,358],()=>s(7326)),_N_E=e.O()}]);