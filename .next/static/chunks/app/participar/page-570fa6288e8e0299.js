(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[376],{5253:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>p});var t=s(5155),a=s(2115),o=s(5695),n=s(2177),l=s(221),i=s(5594),d=s(5522),m=s(6874),c=s.n(m),u=s(6766);let h=i.z.object({fullName:i.z.string().min(3,"Nome completo deve ter no m\xednimo 3 caracteres").regex(/^[A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ ]+$/,"Nome deve conter apenas letras e espa\xe7os"),phone:i.z.string().regex(/^\d{11}$/,"Telefone deve conter exatamente 11 n\xfameros (ex: 11987654321)"),chosenNumbers:i.z.string().refine(e=>{let r=e.split(",").map(e=>e.trim());return r.length>0&&r.every(e=>!isNaN(Number(e)))},{message:"N\xfameros inv\xe1lidos. Insira n\xfameros separados por v\xedrgula."})});function p(){let e=(0,o.useRouter)(),[r,s]=(0,a.useState)(null),[i,m]=(0,a.useState)(!0),[p,x]=(0,a.useState)(!1),[f,b]=(0,a.useState)(null),[g,N]=(0,a.useState)([]),[v,j]=(0,a.useState)(null),[y,w]=(0,a.useState)(1),[_,S]=(0,a.useState)([]),{register:I,handleSubmit:k,formState:{errors:E},setValue:C,watch:z}=(0,n.mN)({resolver:(0,l.u)(h),defaultValues:{fullName:"",phone:"",chosenNumbers:""}});(0,a.useEffect)(()=>{let r=async()=>{let{data:e,error:r}=await d.N.from("raffles").select("*").eq("status","open");if(r)return void console.error("Erro ao buscar sorteios:",r);N(e||[]),e&&e.length>0&&(j(e[0]),await F(e[0]))};(async()=>{var r;let{data:t}=await d.N.auth.getSession();s((null==(r=t.session)?void 0:r.user)||null),m(!1),t.session||e.push("/login")})(),r()},[e]);let F=async e=>{if(e)try{let{data:r,error:s}=await d.N.from("participants").select("chosen_numbers").eq("raffle_id",e.id);if(s)throw s;let t=[];for(let r=e.min_number;r<=e.max_number;r++)t.push(r);let a=(null==r?void 0:r.flatMap(e=>e.chosen_numbers))||[],o=t.filter(e=>!a.includes(e));S(o)}catch(e){console.error("Erro ao buscar n\xfameros dispon\xedveis:",e)}};(0,a.useEffect)(()=>{v&&F(v)},[v]);let M=(e,r)=>{let s=e.split(",").map(e=>parseInt(e.trim(),10));return s.every(e=>e>=r.min_number&&e<=r.max_number)?new Set(s).size!==s.length?"N\xe3o s\xe3o permitidos n\xfameros duplicados":null:"Os n\xfameros devem estar entre ".concat(r.min_number," e ").concat(r.max_number)},O=async s=>{if(!v)return void b({type:"error",text:"Nenhum sorteio selecionado"});let t=M(s.chosenNumbers,v);if(t)return void b({type:"error",text:t});try{x(!0),b(null);let t=s.chosenNumbers.split(",").map(e=>parseInt(e.trim(),10)),{data:a,error:o}=await d.N.from("participants").select("chosen_numbers").eq("raffle_id",v.id);if(o)throw o;let n=(null==a?void 0:a.flatMap(e=>e.chosen_numbers))||[],l=t.filter(e=>n.includes(e));if(l.length>0)return void b({type:"error",text:"Os seguintes n\xfameros j\xe1 foram escolhidos: ".concat(l.join(", "))});if(r&&r.email){let{data:e,error:t}=await d.N.from("participants").select("user_id, name, phone").eq("phone",s.phone);if(t)throw console.error("Erro ao verificar telefone:",t),Error("N\xe3o foi poss\xedvel verificar sua inscri\xe7\xe3o. Tente novamente mais tarde.");if(e&&e.length>0&&e.filter(e=>e.user_id&&e.user_id!==r.id).length>0)return void b({type:"error",text:"Este n\xfamero de telefone j\xe1 est\xe1 sendo usado por outro usu\xe1rio. Cada usu\xe1rio deve ter um telefone \xfanico."});let{data:a,error:o}=await d.N.from("participants").select("user_id, name, phone").eq("name",s.fullName);if(o)throw console.error("Erro ao verificar nome:",o),Error("N\xe3o foi poss\xedvel verificar sua inscri\xe7\xe3o. Tente novamente mais tarde.");if(a&&a.length>0&&a.find(e=>e.phone===s.phone&&e.user_id!==r.id))return void b({type:"error",text:"Este nome e telefone j\xe1 est\xe3o sendo usados por outro usu\xe1rio. Cada participante deve ter dados \xfanicos."})}let{error:i}=await d.N.from("participants").insert({user_id:r.id,name:s.fullName,phone:s.phone,chosen_numbers:t,raffle_id:v.id});if(i)throw i;b({type:"success",text:"Sua participa\xe7\xe3o foi registrada com sucesso!"}),C("fullName",""),C("phone",""),C("chosenNumbers",""),setTimeout(()=>{e.push("/confirmacao")},2e3)}catch(e){b({type:"error",text:e.message||"Erro ao registrar participa\xe7\xe3o"})}finally{x(!1)}};return i?(0,t.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):r?(0,t.jsxs)("div",{className:"max-w-lg mx-auto mt-8 mb-12 p-6 bg-white rounded-lg shadow-md",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-center text-green-600 mb-6",children:"Participar do Sorteio"}),0===g.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("p",{className:"text-lg text-gray-600 mb-4",children:"N\xe3o h\xe1 sorteios dispon\xedveis no momento."}),(0,t.jsx)(c(),{href:"/",className:"text-green-600 hover:text-green-800 font-medium",children:"Voltar para a p\xe1gina inicial"})]}):(0,t.jsxs)(t.Fragment,{children:[f&&(0,t.jsx)("div",{className:"mb-4 p-3 rounded ".concat("success"===f.type?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:f.text}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{htmlFor:"raffle",className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecionar Sorteio"}),(0,t.jsx)("select",{id:"raffle",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",onChange:e=>{j(g.find(r=>r.id===e.target.value)||null)},value:(null==v?void 0:v.id)||"",children:g.map(e=>(0,t.jsx)("option",{value:e.id,children:e.title},e.id))})]}),v&&(0,t.jsxs)("div",{className:"mb-6 p-4 bg-green-50 rounded-md border border-green-200",children:[(0,t.jsx)("h2",{className:"font-bold text-lg mb-2 text-green-700",children:v.title}),v.image_url&&(0,t.jsx)("div",{className:"mb-4 relative",children:(0,t.jsx)("div",{className:"relative w-full h-48 mb-3 overflow-hidden rounded-lg",children:(0,t.jsx)(u.default,{src:v.image_url,alt:v.title,fill:!0,style:{objectFit:"cover"},className:"rounded-lg"})})}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:v.description}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between mb-3 p-3 bg-white rounded-md shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"font-medium text-gray-700 mr-2",children:"N\xfameros dispon\xedveis:"}),(0,t.jsxs)("span",{className:"font-bold text-green-600",children:[v.min_number," a ",v.max_number]})]}),void 0!==v.unit_price&&(0,t.jsx)("div",{className:"ml-auto mt-2 sm:mt-0",children:(0,t.jsxs)("span",{className:"px-3 py-1 bg-yellow-100 text-yellow-800 font-bold rounded-full",children:["Valor: R$ ","number"==typeof v.unit_price?v.unit_price.toFixed(2).replace(".",","):v.unit_price]})})]})]}),(0,t.jsxs)("form",{onSubmit:k(O),className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Completo"}),(0,t.jsx)("input",{id:"fullName",type:"text",...I("fullName"),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",placeholder:"Seu nome completo"}),E.fullName&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:E.fullName.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone (apenas n\xfameros)"}),(0,t.jsx)("input",{id:"phone",type:"tel",inputMode:"numeric",...I("phone"),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",placeholder:"11987654321"}),E.phone&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:E.phone.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"chosenNumbers",className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xfameros escolhidos (separados por v\xedrgula)"}),(0,t.jsx)("input",{id:"chosenNumbers",type:"text",...I("chosenNumbers"),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",placeholder:"1, 5, 10, 25, 50"}),(0,t.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["Escolha n\xfameros entre ",null==v?void 0:v.min_number," e ",null==v?void 0:v.max_number,", separados por v\xedrgula."]}),E.chosenNumbers&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:E.chosenNumbers.message})]}),(0,t.jsxs)("div",{className:"bg-green-50 p-4 rounded-md border border-green-200",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-green-800 mb-2",children:"Gerador de n\xfameros aleat\xf3rios"}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{htmlFor:"randomQuantity",className:"block text-xs text-gray-500 mb-1",children:"Quantidade de n\xfameros"}),(0,t.jsx)("input",{id:"randomQuantity",type:"number",min:"1",max:_.length,value:y,onChange:e=>w(Math.max(1,parseInt(e.target.value)||1)),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 text-sm"})]}),(0,t.jsx)("button",{type:"button",onClick:()=>{if(!v||y<=0||0===_.length)return void b({type:"error",text:"N\xe3o foi poss\xedvel gerar n\xfameros aleat\xf3rios. Verifique a quantidade solicitada."});if(y>_.length)return void b({type:"error",text:"S\xf3 h\xe1 ".concat(_.length," n\xfameros dispon\xedveis. Escolha uma quantidade menor.")});let e=[..._].sort(()=>Math.random()-.5).slice(0,y);e.sort((e,r)=>e-r),C("chosenNumbers",e.join(", "))},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm mt-3",children:"Gerar"})]}),(0,t.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:_.length>0?"".concat(_.length," n\xfameros dispon\xedveis para sorteio."):"Carregando n\xfameros dispon\xedveis..."})]}),(0,t.jsx)("button",{type:"submit",disabled:p,className:"w-full py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 ".concat(p?"opacity-50 cursor-not-allowed":""),children:p?"Processando...":"Confirmar Participa\xe7\xe3o"})]})]})]}):(0,t.jsxs)("div",{className:"max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-md",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:"Fa\xe7a login para participar"}),(0,t.jsx)(c(),{href:"/login",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",children:"Ir para o login"})]})}},5522:(e,r,s)=>{"use strict";s.d(r,{N:()=>n});var t=s(851);let a="https://nkuadhiaeosakxxozxmc.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rdWFkaGlhZW9zYWt4eG96eG1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ4OTQwMzAsImV4cCI6MjA2MDQ3MDAzMH0.SsjaoXLXHV6nOLpCuindrlJ7d1LUbyAteQjSK4Lp9QU";a&&o||console.warn("Vari\xe1veis de ambiente do Supabase n\xe3o definidas corretamente");let n=(0,t.UU)(a,o)},6867:(e,r,s)=>{Promise.resolve().then(s.bind(s,5253))}},e=>{var r=r=>e(e.s=r);e.O(0,[851,874,564,766,441,684,358],()=>r(6867)),_N_E=e.O()}]);