{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Vizantu.dev/RifaBrasil/app/confirmacao/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { supabase } from '@/utils/supabase';\r\nimport { Participant, Raffle } from '@/types';\r\n\r\nexport default function ConfirmacaoPage() {\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [participation, setParticipation] = useState<Participant | null>(null);\r\n  const [user, setUser] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    const checkUserAndParticipation = async () => {\r\n      try {\r\n        setLoading(true);\r\n        // Verificar se o usuário está logado\r\n        const { data: sessionData } = await supabase.auth.getSession();\r\n        const currentUser = sessionData.session?.user || null;\r\n        setUser(currentUser);\r\n        \r\n        if (!currentUser) {\r\n          setError('Usuário não autenticado. Faça login para ver suas participações.');\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        \r\n        try {\r\n          // Primeiro buscar a participação\r\n          const { data: participantData, error: participantError } = await supabase\r\n            .from('participants')\r\n            .select('*')\r\n            .eq('user_id', currentUser.id)\r\n            .order('created_at', { ascending: false })\r\n            .limit(1)\r\n            .single();\r\n            \r\n          if (participantError) {\r\n            // Se for erro de \"não encontrado\", damos uma mensagem amigável\r\n            if (participantError.code === 'PGRST116') {\r\n              setError('Você ainda não participou de nenhum sorteio. Participe agora!');\r\n            } else {\r\n              console.error('Erro ao buscar dados:', participantError);\r\n              setError('Não foi possível carregar sua participação. Tente novamente mais tarde.');\r\n            }\r\n            return;\r\n          }\r\n          \r\n          // Depois buscar o sorteio relacionado\r\n          if (participantData) {\r\n            const { data: raffleData, error: raffleError } = await supabase\r\n              .from('raffles')\r\n              .select('*')\r\n              .eq('id', participantData.raffle_id)\r\n              .single();\r\n              \r\n            if (raffleError) {\r\n              console.error('Erro ao buscar sorteio:', raffleError);\r\n              // Ainda podemos mostrar os dados do participante mesmo sem o sorteio\r\n              setParticipation(participantData);\r\n            } else {\r\n              // Combinar os dados do participante com o sorteio\r\n              const fullParticipation: Participant = {\r\n                ...participantData,\r\n                raffles: raffleData as Raffle\r\n              };\r\n              setParticipation(fullParticipation);\r\n            }\r\n          }\r\n        } catch (participationError) {\r\n          console.error('Erro inesperado:', participationError);\r\n          setError('Ocorreu um erro inesperado. Por favor, tente novamente.');\r\n        }\r\n      } catch (sessionError) {\r\n        console.error('Erro na sessão:', sessionError);\r\n        setError('Erro ao verificar sua sessão. Por favor, faça login novamente.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    \r\n    checkUserAndParticipation();\r\n  }, []);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center min-h-[60vh]\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !participation) {\r\n    return (\r\n      <div className=\"max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-md border-t-4 border-green-600\">\r\n        <h1 className=\"text-2xl font-bold text-center text-green-600 mb-6\">\r\n          {!participation ? 'Sem participações encontradas' : 'Ops! Algo deu errado'}\r\n        </h1>\r\n        <p className=\"text-gray-600 mb-6 text-center\">\r\n          {error || 'Não foi possível encontrar sua participação. Tente novamente.'}\r\n        </p>\r\n        <div className=\"flex justify-center space-x-4\">\r\n          <Link\r\n            href=\"/participar\"\r\n            className=\"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors\"\r\n          >\r\n            Participar de um sorteio\r\n          </Link>\r\n          <Link\r\n            href=\"/\"\r\n            className=\"px-4 py-2 border border-green-600 text-green-600 rounded-md hover:bg-green-50 transition-colors\"\r\n          >\r\n            Página inicial\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-lg mx-auto mt-10 mb-10 p-6 bg-white rounded-lg shadow-md border-t-4 border-green-600\">\r\n      <div className=\"text-center mb-6\">\r\n        <div className=\"inline-flex items-center justify-center h-16 w-16 rounded-full bg-green-100 text-green-600 mb-4\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-8 w-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n          </svg>\r\n        </div>\r\n        <h1 className=\"text-2xl font-bold text-title\">Participação Confirmada!</h1>\r\n      </div>\r\n      \r\n      <div className=\"border-t border-b border-gray-200 py-4 mb-6\">\r\n        <h2 className=\"font-bold text-lg mb-4 text-title\">Detalhes da sua participação:</h2>\r\n        \r\n        <div className=\"space-y-3\">\r\n          <div>\r\n            <span className=\"text-title font-medium\">Nome:</span>\r\n            <p className=\"text-important\">{participation.name}</p>\r\n          </div>\r\n          \r\n          <div>\r\n            <span className=\"text-title font-medium\">Telefone:</span>\r\n            <p className=\"text-important\">{participation.phone}</p>\r\n          </div>\r\n          \r\n          <div>\r\n            <span className=\"text-title font-medium\">Números escolhidos:</span>\r\n            <p className=\"flex flex-wrap gap-2 mt-1\">\r\n              {participation.chosen_numbers.map((number) => (\r\n                <span key={number} className=\"inline-block px-3 py-1 bg-green-100 text-black rounded-full text-sm\">\r\n                  {number}\r\n                </span>\r\n              ))}\r\n            </p>\r\n          </div>\r\n          \r\n          <div>\r\n            <span className=\"text-title font-medium\">Data de participação:</span>\r\n            <p className=\"text-important\">{new Date(participation.created_at).toLocaleString('pt-BR')}</p>\r\n          </div>\r\n          \r\n          {participation.raffles && (\r\n            <div>\r\n              <span className=\"text-title font-medium\">Sorteio:</span>\r\n              <p className=\"text-important\">{participation.raffles.title}</p>\r\n              {participation.raffles.unit_price && (\r\n                <p className=\"mt-1\">\r\n                  <span className=\"inline-block px-3 py-1 bg-yellow-100 text-black rounded-full text-sm\">\r\n                    Valor: R$ {typeof participation.raffles.unit_price === 'number' \r\n                      ? participation.raffles.unit_price.toFixed(2).replace('.', ',') \r\n                      : participation.raffles.unit_price}\r\n                  </span>\r\n                </p>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"space-y-4\">\r\n        <p className=\"text-description text-center\">\r\n          Obrigado por participar! Você receberá uma notificação quando o sorteio for realizado.\r\n        </p>\r\n        \r\n        <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\r\n          <Link\r\n            href=\"/participar\"\r\n            className=\"inline-block text-center px-4 py-2 border border-green-600 text-green-600 rounded-md hover:bg-green-50 transition-colors\"\r\n          >\r\n            Participar de outro sorteio\r\n          </Link>\r\n          \r\n          <Link\r\n            href=\"/resultados\"\r\n            className=\"inline-block text-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors\"\r\n          >\r\n            Ver resultados\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n} "],"names":[],"mappings":"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","debugId":null}}]
}